<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Kamera, Ovoz va Xarita</title>
<style>
  body {
    margin: 0;
    background: #222;
    font-family: 'Segoe UI', sans-serif;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
  }
  h1 {
    margin: 10px 0;
    text-align: center;
  }
  .camera-frame {
    width: 100%;
    max-width: 480px;
    aspect-ratio: 4 / 3;
    border: 3px solid #4caf50;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 15px #4caf50aa;
    background: black;
  }
  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .audio-visualizer {
    margin-top: 15px;
    width: 100%;
    max-width: 480px;
    height: 60px;
    background: #111;
    border-radius: 10px;
    box-shadow: 0 0 10px #4caf50;
    overflow: hidden;
  }
  #map {
    margin-top: 15px;
    width: 100%;
    max-width: 480px;
    aspect-ratio: 4 / 3;
    border-radius: 12px;
    box-shadow: 0 0 15px #4caf50aa;
  }
</style>
</head>
<body>

  <h1>Kamera + Ovoz + Xarita</h1>

  <div class="camera-frame">
    <video id="video" autoplay muted playsinline></video>
  </div>

  <div class="audio-visualizer">
    <canvas id="canvas" width="480" height="60"></canvas>
  </div>

  <div id="map"></div>

<script>
  async function startCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      const video = document.getElementById('video');
      video.srcObject = stream;

      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(stream);
      const analyser = audioContext.createAnalyser();
      source.connect(analyser);
      analyser.fftSize = 256;

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      function draw() {
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);
        ctx.fillStyle = '#111';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        const barWidth = (canvas.width / bufferLength) * 2.5;
        let barHeight, x = 0;
        for (let i = 0; i < bufferLength; i++) {
          barHeight = dataArray[i] / 2;
          ctx.fillStyle = 'rgb(75,175,80)';
          ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
          x += barWidth + 1;
        }
      }
      draw();
    } catch (e) {
      alert('Kamera/mikrofonga ruxsat berilmadi: ' + e.message);
    }
  }

  function initMap(lat, lng) {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat, lng },
      zoom: 15,
      disableDefaultUI: true
    });
    const marker = new google.maps.Marker({
      position: { lat, lng },
      map: map,
      title: "Siz bu yerdasiz"
    });
    return { map, marker };
  }

  function updatePosition(mapObj, lat, lng) {
    const { map, marker } = mapObj;
    const newPos = new google.maps.LatLng(lat, lng);
    marker.setPosition(newPos);
    map.panTo(newPos);
  }

  function startLocation(mapObj) {
    if (!navigator.geolocation) {
      alert("Geolokatsiya brauzer tomonidan qo'llab-quvvatlanmaydi.");
      return;
    }
    navigator.geolocation.watchPosition(
      pos => {
        updatePosition(mapObj, pos.coords.latitude, pos.coords.longitude);
      },
      err => {
        alert("Geolokatsiya xatosi yoki ruxsat berilmadi.");
      },
      { enableHighAccuracy: true, maximumAge: 10000, timeout: 5000 }
    );
  }

  async function main() {
    await startCamera();
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          const mapObj = initMap(pos.coords.latitude, pos.coords.longitude);
          startLocation(mapObj);
        },
        err => {
          alert("Geolokatsiyaga ruxsat berilmadi.");
        }
      );
    }
  }
  main();
</script>

<!-- Sizning API kalitingiz shu joyda -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_REAL_API_KEY"></script>

</body>
</html>